<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Договори (EUR) - Генератор</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Slate-100 */
        }

        /* Custom Input Styles to match React App */
        .custom-input {
            background-color: #f8fafc; /* Slate-50 */
            border: 1px solid #e2e8f0; /* Slate-200 */
            border-radius: 0.75rem; /* rounded-xl */
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            font-weight: 700;
            color: #334155; /* Slate-700 */
            outline: none;
            width: 100%;
            transition: all 0.2s;
        }
        .custom-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }
        .custom-label {
            display: block;
            font-size: 0.65rem;
            font-weight: 900;
            text-transform: uppercase;
            color: #94a3b8; /* Slate-400 */
            margin-bottom: 0.25rem;
            margin-left: 0.25rem;
            letter-spacing: 0.05em;
        }

        /* Tab styles */
        .tab-btn {
            padding: 0.75rem 1.5rem;
            font-size: 0.75rem;
            font-weight: 900;
            text-transform: uppercase;
            border-radius: 0.75rem;
            color: #64748b; /* Slate-500 */
            transition: all 0.2s;
        }
        .tab-btn:hover {
            background-color: #f1f5f9;
            color: #3b82f6;
        }
        .tab-btn.active {
            background-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3);
        }

        /* PDF Styling (Hidden) */
        #pdf-content {
            position: absolute;
            left: -9999px;
            width: 210mm;
            color: black;
        }
        .pdf-logical-page {
            background: white;
            font-family: 'Times New Roman', Times, serif;
            font-size: 10pt;
            line-height: 1.4;
            padding: 15mm 15mm;
            box-sizing: border-box;
            margin-bottom: 1mm; 
            text-align: justify;
        }
        .pdf-logical-page h1, .pdf-logical-page h2 {
            text-align: center;
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        .pdf-logical-page h1 { font-size: 14pt; }
        .pdf-logical-page h2 { font-size: 11pt; }
        .pdf-logical-page p { margin-bottom: 6px; }
        .signatures { margin-top: 40px; display: flex; justify-content: space-between; font-weight: bold; }
        .tourist-table-pdf { width: 100%; border-collapse: collapse; margin: 10px 0; font-size: 9pt; }
        .tourist-table-pdf th, .tourist-table-pdf td { border: 1px solid black; padding: 3px; text-align: left; }
    </style>
</head>
<body class="antialiased min-h-screen pb-20">

    <div class="max-w-5xl mx-auto p-6">
        
        <div class="bg-white rounded-[2rem] shadow-sm border border-slate-200 p-6 mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
                <h1 class="text-2xl font-black text-slate-800 uppercase tracking-tighter">Генератор на Договори</h1>
                <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mt-1">Официална валута: ЕВРО (€)</p>
            </div>
            <button type="button" id="generate-pdf-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-2xl shadow-lg shadow-blue-500/30 flex items-center gap-2 font-black uppercase text-xs tracking-wide transition-all transform hover:scale-105">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                Генерирай PDF
            </button>
        </div>

        <div class="bg-white rounded-[2.5rem] shadow-xl border border-slate-100 overflow-hidden">
            
            <div class="px-8 pt-8 pb-4 border-b border-slate-100">
                <nav class="flex flex-wrap gap-2" id="tab-nav">
                    <button data-tab="tab-1" class="tab-btn active">1. Основна информация</button>
                    <button data-tab="tab-2" class="tab-btn">2. Туристи</button>
                    <button data-tab="tab-3" class="tab-btn">3. Детайли за пътуването</button>
                    <button data-tab="tab-4" class="tab-btn">4. Финанси (EUR)</button>
                </nav>
            </div>

            <form id="contract-form" class="p-8">

                <div id="tab-1" class="tab-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="contractNumber" class="custom-label">Номер на договор</label>
                            <input type="text" id="contractNumber" class="custom-input" placeholder="2025/001">
                        </div>
                        <div>
                            <label for="signingDate" class="custom-label">Дата на подписване</label>
                            <input type="date" id="signingDate" class="custom-input">
                        </div>
                    </div>
                </div>

                <div id="tab-2" class="tab-content hidden">
                    <div class="bg-slate-50 p-6 rounded-[2rem] border border-slate-100 mb-8">
                        <h3 class="text-sm font-black text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                            <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                            Основен Потребител
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="md:col-span-2">
                                <label for="mainTouristName" class="custom-label">Трите имена</label>
                                <input type="text" id="mainTouristName" class="custom-input" placeholder="Име Презиме Фамилия">
                            </div>
                            <div>
                                <label for="mainTouristEGN" class="custom-label">ЕГН</label>
                                <input type="text" id="mainTouristEGN" class="custom-input" placeholder="0000000000">
                            </div>
                            <div>
                                <label for="mainTouristIdCard" class="custom-label">Л.К. №</label>
                                <input type="text" id="mainTouristIdCard" class="custom-input" placeholder="600000000">
                            </div>
                            <div class="md:col-span-2">
                                <label for="mainTouristAddress" class="custom-label">Адрес</label>
                                <input type="text" id="mainTouristAddress" class="custom-input" placeholder="гр. София, ул. ...">
                            </div>
                            <div>
                                <label for="mainTouristPhone" class="custom-label">Телефон</label>
                                <input type="text" id="mainTouristPhone" class="custom-input" placeholder="0888123456">
                            </div>
                            <div class="md:col-span-2">
                                <label for="mainTouristEmail" class="custom-label">Email</label>
                                <input type="email" id="mainTouristEmail" class="custom-input" placeholder="email@example.com">
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-sm font-black text-slate-400 uppercase tracking-widest">Списък Пътници</h3>
                        <button type="button" id="add-tourist-btn" class="bg-slate-100 hover:bg-slate-200 text-slate-600 p-2 rounded-full transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                        </button>
                    </div>
                    
                    <div class="overflow-hidden rounded-2xl border border-slate-200">
                        <table class="w-full text-sm text-left">
                            <thead class="text-xs text-slate-400 uppercase bg-slate-50 font-black">
                                <tr>
                                    <th scope="col" class="px-4 py-3 w-10 text-center">#</th>
                                    <th scope="col" class="px-4 py-3">Имена</th>
                                    <th scope="col" class="px-4 py-3">ЕГН</th>
                                    <th scope="col" class="px-4 py-3">Документ</th>
                                    <th scope="col" class="px-4 py-3 text-center"></th>
                                </tr>
                            </thead>
                            <tbody id="tourists-table-body" class="divide-y divide-slate-100">
                                </tbody>
                        </table>
                    </div>
                </div>

                <div id="tab-3" class="tab-content hidden">
                    <div class="bg-blue-50/50 p-6 rounded-[2rem] border border-blue-100/50 mb-6 grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label for="startDate" class="custom-label text-blue-400">Начална дата</label>
                            <input type="date" id="startDate" class="custom-input bg-white">
                        </div>
                        <div>
                            <label for="endDate" class="custom-label text-blue-400">Крайна дата</label>
                            <input type="date" id="endDate" class="custom-input bg-white">
                        </div>
                        <div>
                            <label for="tripDuration" class="custom-label text-blue-400">Продължителност</label>
                            <input type="text" id="tripDuration" class="custom-input bg-blue-50 text-blue-600" readonly placeholder="-">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="md:col-span-2">
                            <label for="transportDesc" class="custom-label">1. Транспорт</label>
                            <textarea id="transportDesc" rows="1" class="custom-input" placeholder="Автобус / Самолет..."></textarea>
                        </div>
                        <div>
                            <label for="departureInfo" class="custom-label">Час/място тръгване</label>
                            <input type="text" id="departureInfo" class="custom-input" placeholder="06:00, София">
                        </div>
                        <div>
                            <label for="returnInfo" class="custom-label">Час/място връщане</label>
                            <input type="text" id="returnInfo" class="custom-input" placeholder="22:00, София">
                        </div>
                        <div class="md:col-span-2">
                            <label for="accommodationDesc" class="custom-label">2. Настаняване</label>
                            <textarea id="accommodationDesc" rows="2" class="custom-input" placeholder="Хотел Име 3*, Град..."></textarea>
                        </div>
                        <div>
                            <label for="roomType" class="custom-label">Вид стаи</label>
                            <input type="text" id="roomType" class="custom-input" placeholder="Двойна стая">
                        </div>
                        <div class="md:col-span-2">
                            <label for="mealsDesc" class="custom-label">3. Хранения</label>
                            <input type="text" id="mealsDesc" class="custom-input" placeholder="BB (Закуска) / HB (Закуска и Вечеря)">
                        </div>
                        <div class="md:col-span-2">
                            <label for="otherServices" class="custom-label">3.3. Други услуги</label>
                            <textarea id="otherServices" rows="2" class="custom-input" placeholder="Водач, застраховка..."></textarea>
                        </div>
                        <div class="md:col-span-2">
                            <label for="specialReqs" class="custom-label">3.4. Специални изисквания</label>
                            <textarea id="specialReqs" rows="1" class="custom-input" placeholder="Няма"></textarea>
                        </div>
                    </div>
                </div>
                
                <div id="tab-4" class="tab-content hidden">
                    <div class="bg-emerald-50/50 p-6 rounded-[2rem] border border-emerald-100/50 mb-6">
                        <h3 class="text-sm font-black text-emerald-500 uppercase tracking-widest mb-4">Финанси (Всички цени са в ЕВРО)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="totalPrice" class="custom-label text-emerald-600">3.5 Обща цена (€)</label>
                                <input type="number" id="totalPrice" class="custom-input bg-white text-emerald-600 font-black text-lg" placeholder="0.00">
                            </div>
                            <div>
                                <label for="finalAmount" class="custom-label text-emerald-600">3.6 Крайна дължима сума (€)</label>
                                <input type="number" id="finalAmount" class="custom-input bg-white text-emerald-600 font-black text-lg" placeholder="0.00">
                            </div>
                            <div>
                                <label for="depositAmount" class="custom-label text-emerald-600">Депозит (€)</label>
                                <input type="number" id="depositAmount" class="custom-input bg-white" placeholder="0.00">
                            </div>
                            <div>
                                <label for="finalPayment" class="custom-label text-emerald-600">Остатък (€) и срок</label>
                                <input type="text" id="finalPayment" class="custom-input bg-white" placeholder="... евро до ДД.ММ.ГГГГ">
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="otherPayments" class="custom-label">3.5.1 Други плащания</label>
                            <input type="text" id="otherPayments" class="custom-input" placeholder="Такси...">
                        </div>
                        <div>
                            <label for="childDiscount" class="custom-label">3.5.1.1 Отстъпка деца</label>
                            <input type="text" id="childDiscount" class="custom-input" placeholder="20 €">
                        </div>
                        <div>
                            <label for="adultDiscount" class="custom-label">3.5.1.2 Отстъпка 3-ти възрастен</label>
                            <input type="text" id="adultDiscount" class="custom-input" placeholder="10 €">
                        </div>
                        <div>
                            <label for="singleRoomFee" class="custom-label">3.5.1.3 Доплащане единична стая</label>
                            <input type="text" id="singleRoomFee" class="custom-input" placeholder="50 €">
                        </div>
                        <div>
                            <label for="extraExcursion" class="custom-label">3.5.1.4 Допълнителни екскурзии</label>
                            <input type="text" id="extraExcursion" class="custom-input" placeholder="...">
                        </div>
                        <div class="md:col-span-2">
                            <label for="insurance" class="custom-label">3.5.1.5 Застраховка</label>
                            <input type="text" id="insurance" class="custom-input" placeholder="Медицинска застраховка...">
                        </div>
                        <div class="md:col-span-2">
                            <label for="paymentTerms" class="custom-label">3.7 Начин на плащане</label>
                            <input type="text" id="paymentTerms" class="custom-input" placeholder="В брой / Банков път">
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div id="loading-modal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="flex flex-col items-center text-white">
            <svg class="animate-spin h-12 w-12 text-blue-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="text-xl font-bold uppercase tracking-widest">Генериране...</p>
        </div>
    </div>

    <div id="pdf-content">
        <div class="pdf-logical-page">
            <h1>ДОГОВОР ЗА ТУРИСТИЧЕСКИ ПАКЕТ № <span id="pdf-contractNumber"></span></h1>
            <p style="text-align: center;">съгласно разпоредбите на Закона за туризма</p>
            <p>Днес, <span id="pdf-signingDate"></span> в гр. Ракитово, се подписа настоящия договор за пътуване между:</p>
            <p>
                <b>“ДАЙНАМЕКС ТУР” ЕООД</b> с удостоверение за туроператор № РК-01-8569/15.04.2025г., с адрес на управление гр. Ракитово, ул. "Васил Куртев" №12А, тел. 0879976446, Булстат № BG208193140 , представлявана и управлявана от КРАСИМИР ЕМИЛОВ АНАНОВ, наричан по долу за краткост <b>ТУРОПЕРАТОР</b> от една страна и
            </p>
            <p>
                ИМЕНА: <b id="pdf-mainTouristName"></b>, ЕГН: <b id="pdf-mainTouristEGN"></b>, Л.К. №: <b id="pdf-mainTouristIdCard"></b>,
                АДРЕС: <b id="pdf-mainTouristAddress"></b>, GSM: <b id="pdf-mainTouristPhone"></b>, EMAIL: <b id="pdf-mainTouristEmail"></b>
            </p>
            <p>от друга страна, наричан за краткост <b>ПОТРЕБИТЕЛ</b> се сключи настоящият договор за следното:</p>
            <div id="pdf-tourists-table-container"></div>
        </div>

        <div class="pdf-logical-page">
            <h2>І. ПРЕДМЕТ НА ДОГОВОРА</h2>
            <p>1. Потребителят възлага и заплаща на Туроператора да му предостави туристическо пътуване при определен маршрут и платена от него цена при условията на настоящия договор.</p>
            <p>2. Туроператорът приема да организира туристическото пътуване на Потребителя по определен маршрут заплащане на договорената цена при условията на настоящия договор.</p>
            <p>3. Организирано туристическо пътуване е при следните условия:</p>
            <p><b>3.1. Маршрут на пътуването</b><br>
                Начална дата на пътуването: <span id="pdf-startDate"></span> &nbsp;&nbsp;Крайна дата на пътуването: <span id="pdf-endDate"></span><br>
                Продължителност на пътуването: <span id="pdf-tripDuration"></span>
            </p>
            <p><b>3.2. Основни услуги, включени в общата цена</b><br>
                1. Транспорт: <span id="pdf-transportDesc"></span><br>
                Час и място на тръгване: <span id="pdf-departureInfo"></span><br>
                Час и място на връщане: <span id="pdf-returnInfo"></span><br>
                2. Настаняване: <span id="pdf-accommodationDesc"></span><br>
                Брой и вид стаи: <span id="pdf-roomType"></span><br>
                3. Брой и вид на храненията, включени в пакетната цена: <span id="pdf-mealsDesc"></span>
            </p>
            <p><b>3.3. Други услуги, включени в общата цена:</b> <span id="pdf-otherServices"></span></p>
            <p><b>3.4. Специални изисквания на потребителя, за които е постигнато съгласие между двете страни по този договор:</b> <span id="pdf-specialReqs"></span></p>
            <p><b>3.5. Обща цена в евро на пътуването:</b> <span id="pdf-totalPrice"></span></p>
            <p><b>3.5.1. Други плащания, включени в цената:</b> <span id="pdf-otherPayments"></span></p>
            <p><b>3.5.1.1. Отстъпки за деца до 10/12 г., настанени с двама възрастни в двойна стая:</b> <span id="pdf-childDiscount"></span></p>
            <p><b>3.5.1.2. Отстъпки за трети възрастен в тройна стая, общо:</b> <span id="pdf-adultDiscount"></span></p>
            <p><b>3.5.1.3. Доплащане за единична стая:</b> <span id="pdf-singleRoomFee"></span></p>
            <p><b>3.5.1.4. Други - допълнителна екскурзия:</b> <span id="pdf-extraExcursion"></span></p>
            <p><b>3.5.1.5. Застраховка:</b> <span id="pdf-insurance"></span></p>
            <p><b>3.6 Крайна обща дължима сума:</b> <span id="pdf-finalAmount"></span></p>
            <p><b>3.7 Начин и срок за плащане на пълната сума по пътуването:</b> <span id="pdf-paymentTerms"></span></p>
            <p>ПОТВЪРЖДАВАМ от свое име и от името на гореизброените туристи, че съм запознат с условията за записване и програмата на пътуването и внасям депозит от <span id="pdf-depositAmount"></span> €</p>
            <p>Потребителят се задължава да заплати остатъка от пълната сума в размер на <span id="pdf-finalPayment"></span>.</p>
            <div class="signatures">
                <span>ЗА ТУРОПЕРАТОРА</span>
                <span>ЗА ПОТРЕБИТЕЛЯ</span>
            </div>
            <div class="signatures" style="margin-top: 80px;">
                <span>.........................</span>
                <span>.........................</span>
            </div>
        </div>

        <div class="pdf-logical-page">
            <p><b>Туристическа програма</b> - означава разглеждане на посещаваното селище пеша и/или с градски транспорт, като обектите се разглеждат отвън, освен ако в програмата не с упоменато изрично „посещение" на туристическия обект или друго. Екскурзоводът от фирмата няма право да води групата в музеи , където това право имат само местни оторизирани екскурзоводи, които при желание от страна на групата могат да бъдат наети срещу допълнително заплащане. В някои от посещаваните градове се налага ползването на обществен транспорт, който Потребителят плаща за своя сметка.</p>
            <p><b>8.2. Панорамна обиколка</b> -означава разглеждане на посещаваното селище с автобуса, като в някои случаи може да се спре и за пешеходно разглеждане по преценка на водача/екскурзовода.</p>
            <p><b>8.3. Свободно време</b> -означава време, косто се дава от водача/екскурзовода на групата обикновено след предварително запознаване със съответното селище и което потребителят сам преценява как да оползотвори. През това време водачът/екскурзоводът на групата и автобусът не са на разположение на туристите.</p>
            <p><b>8.4. Екскурзия по желание</b> -означава допълнителна факултативна екскурзия, алтернативна на свободното време, цената на която не е включена в общата цена, освен ако в програмата не е упоменато друго. Цената на екскурзията по желание се вписва в графа „цената не включва" в съответната програма.</p>
            <p><b>8.5. Екскурзия без нощен преход</b> - означава организирано туристическо пътуване с обща цена по време на което няма предвидени нощувки в използваното превозно средство.</p>
            <p><b>8.6. Екскурзия с нощен преход</b> - означава организирано туристическо пътуване с обща цена по време на което има предвидена поне една нощувка в използваното превозно средство.</p>
            <p><b>8.7. Закуска / вечеря / друг вид хранене на блок маса (шведска маса, открит бюфет)</b> -означава хранене при което храната е поставена на общ плот или маса от която потребителят може да избере и консумира различни храни и питиета по своя преценка. Блок масата обикновено включва: колбас, кашкавал, масло, конфитюр, чай, кафе и др. Разнообразието и богатството на храните и напитките зависи от съответното заведение за хранене и развлечение.</p>
            <p><b>8.8. Посещение на туристически обект</b> означава разглеждане отвътре на посочения обект, като в програмата изрично е посочено понятието „ПОСЕЩЕНИЕ". В повечето случаи посещенията на туристически обекти изискват заплащане на входна такса (закупуване на билет), освен ако в програмата не е упоменато друго.Препоръчваме: потребителят да осигури още в България сумите, които предвижда да похарчи в съответните валути за посещаваните държави. Музейните такси се плащат само в местна валута</p>
        </div>

        <div class="pdf-logical-page">
            <p><b>8.9. Нощувка в</b> - означава, че нощувката е в рамките на обявеното селище.</p>
            <p><b>8.10.Нощувка в района на</b> - означава, че нощувката е в друго селище в близост до обявеното селище.</p>
            <p><b>9. Спорове и рекламации:</b></p>
            <p>9.1. Всички рекламации, свързани с качеството на платените услуги, в т.ч. конкретните условия в хотелите и хотелските вериги, трябва да бъдат предявени от потребителя на място пред доставчика на услугите и представител/екскурзовод на туроператора или пред обслужващата фирма туроператор за отстраняване на слабостите. В случай, че заинтересованите страни не са удовлетворени, предявяването на рекламацията става в писмена или друга подходяща форма, позволяваща то да бъде възпроизведено в срок до 14 календарни дни след крайната дата на организираното пътуване.</p>
            <p>9.2. Туроператорът се задължава в срок от 10 дни след получаване на рекламацията да даде своето писмено становище по нея.</p>
            <p>Забележка: Потребителят не трябва да забравя, че категорията на хотелите и автобусите се определя от оторизираните власти на съответната страна, а не от туроператора.</p>
            <p><b>10. Ред за изменение и прекратяване на договора:</b></p>
            <p>10.1. Настоящият договор може да бъде отменян, изменян и допълван с двустранни писмени анекси и при спазване разпоредбите на 3Т.</p>
            <p>10.2.Всяка от страните има право да поиска изменение или да прекрати Договора във връзка със съществени изменения на обстоятелствата,</p>
            <p>10.3.Споразумение за изменение или уведомление за прекратяване на Договора се извършва в писмена форма.</p>
            <p>10.4. При изменение на Договора задълженията на страните се запазват в изменен вид. При прекратяване на Договора задълженията на страните се прекратяват след уреждане на финансовите взаимоотношения</p>
            <p>10.5. За неуредени в договора выпроси се прилагат разпоредбите на 3Т, 33П, Търговския закон, Закона за задълженията и договорите и останалото действащо законодателство на Р...България.</p>
            <p>10.6. Анекс към Договора за организирано пътуване е подробно описание на туристическата програма.</p>
            <p>10.7. Потребителят декларира с подписа си, че той и записаните от него туристи са запознати с програмата на екскурзията и общите условия на организираното пътуване, описани в настоящия договор и ги приемат.</p>
            <p>10.8. Този договор се изготви в два екземпляра, по един за всяка от страните и се подписа на всяка страница, както следва:</p>
            <div class="signatures">
                <span>ЗА ТУРОПЕРАТОРА</span>
                <span>ЗА ПОТРЕБИТЕЛЯ</span>
            </div>
             <div class="signatures" style="margin-top: 80px;">
                <span>.........................</span>
                <span>.........................</span>
            </div>
        </div>
        
        <div class="pdf-logical-page">
            <h2>ПРИЛОЖЕНИЕ Nº 1 КЪМ ДОГОВОР ЗА ТУРИСТИЧЕСКИ ПАКЕТ</h2>
            <h2 style="margin-top:0;">ДЕКЛАРАЦИЯ - СЪГЛАСИЕ ЗА ОБРАБОТКА НА ЛИЧНИ ДАННИ</h2>
            <p>В качеството си на администратор на лични данни, „ДАЙНАМЕКС ТУР" ЕООД, ЕИК 208193140, следва да е получило и/или ще получи от Вас лични данни, които ще обработва, за да предостави услугите си. В случай, че не предоставите личните си данни, „ДАЙНАМЕКС ТУР" няма да може да предостави услугите си, включително да направи резервация от Ваше име за желания период и място.</p>
            <p>С подписа си по-долу Вие потвърждавате, че:</p>
            <p>- Сте получили на хартиен носител Политиката ни за поверителност с подробна информация за това какви Ваши лични данни събиране и обработваме, за каква цел, за какъв срок и на какво основание ги обработваме, на кого ги представяме и какви са Вашите права във връзка с тази обработка;</p>
            <p>- Сме Ви информирали, че посочената Политика за поверителност е налична и онлайн на интернет адрес http://dynamextour.com;</p>
            <p>- Ако за целите на предоставянето на услугата, която се закупили, сте ни предоставили или ще ни предоставите лични данни на трети лица (например приятели, познати или членове на семейството, които ще пътуват с Вас), Вие декларирате, че ще информирате тези трети лица за това, че сте ни предоставили техните лични данни, както и да им предоставите екземпляр от Политиката за поверителност или да ги насочите към посочения по-горе адрес, на който то е достъпно чрез уеб-страницата;</p>
            <p>- Декларирате истинността на предоставената ни информация, включително актуалността и верността на личните данни.</p>
            <br><br>
            <p>........................................................................</p>
            <p>ТРИ ИМЕНА И ПОДПИС</p>
            <p>ДАТА: <span id="pdf-declarationDate1"></span></p>
        </div>

        <div class="pdf-logical-page">
            <h2 style="margin-top: 0;">ДЕКЛАРАЦИЯ - ПОТВЪРЖДЕНИЕ ЗА ИНФОРМИРАНОСТ ОТНОСНО УСЛОВИЯТА И ОСНОВНИТЕ ХАРАКТЕРИСТИКИ НА ПАКЕТА</h2>
            <p>Долуподписаният <b id="pdf-declarationName"></b>, ЕГН: <b id="pdf-declarationEGN"></b>, телефон за връзка, <b id="pdf-declarationPhone"></b> в качеството ми на Потребител по Договор Nº <b id="pdf-declarationContractNumber"></b></p>
            <p>ДЕКЛАРИРАМ, ЧЕ:</p>
            <p>Преди да подпиша договора за туристически пакет, от Туроператора и/ или Турагента, в това число и чрез електронния сайт на Дружеството, съм получил цялата съпътстваща информация за условията на пакета, който желая да закупя, съответно и всички данни за моето пътуване и почивка, получил съм подробна и пълна информация на всички поставени от мен вьпроси, предлаганият туристически пакет съм избрал доброволно и съм съгласен изцяло с неговите условия и характеристики, в това число, но не само и с условията за плащане, минималния брой участници, за които ще се осъществи програмата, получил съм информация и за възможността си да сключа договор за доброволна застраховка за покриване на разходи в случай, че прекратя туристическия пакет, като цялата получена от мен преддоговорната информация ме удовлетворява напълно и в знак на съгласие от мое име и от името на записаните от мен лица, полагам подписа си под настоящата Декларация и подписвам Договора за туристически пакет, заедно с всички негови приложения.</p>
            <br><br>
            <p>ДАТА: <span id="pdf-declarationDate2"></span></p>
            <p style="text-align: right; margin-top: 20px;">(подпис) ................................</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- UI Elements ---
            const tabNav = document.getElementById('tab-nav');
            const tabContents = document.querySelectorAll('.tab-content');
            const addTouristBtn = document.getElementById('add-tourist-btn');
            const touristsTableBody = document.getElementById('tourists-table-body');
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            const durationInput = document.getElementById('tripDuration');
            const generatePdfBtn = document.getElementById('generate-pdf-btn');
            const loadingModal = document.getElementById('loading-modal');

            let touristCount = 0;

            // --- Initial Setup ---
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('signingDate').value = today;

            // --- Event Listeners ---
            tabNav.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    const targetTab = e.target.dataset.tab;
                    tabNav.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    tabContents.forEach(content => {
                        content.classList.toggle('hidden', content.id !== targetTab);
                    });
                }
            });

            addTouristBtn.addEventListener('click', addTouristRow);

            touristsTableBody.addEventListener('click', function(e) {
                const removeBtn = e.target.closest('.remove-tourist-btn');
                if (removeBtn) {
                    removeBtn.closest('tr').remove();
                    updateTouristRowNumbers();
                }
            });

            startDateInput.addEventListener('change', calculateDuration);
            endDateInput.addEventListener('change', calculateDuration);

            generatePdfBtn.addEventListener('click', handlePdfGeneration);

            // --- Functions ---
            function addTouristRow() {
                touristCount++;
                const row = document.createElement('tr');
                row.classList.add('bg-white', 'border-b', 'hover:bg-slate-50');
                row.innerHTML = `
                    <td class="px-4 py-3 text-center font-bold text-slate-400"></td>
                    <td class="px-4 py-2"><input type="text" class="custom-input bg-slate-50 tourist-name" placeholder="Трите имена"></td>
                    <td class="px-4 py-2"><input type="text" class="custom-input bg-slate-50 tourist-egn" placeholder="ЕГН"></td>
                    <td class="px-4 py-2"><input type="text" class="custom-input bg-slate-50 tourist-id" placeholder="Л.К."></td>
                    <td class="px-4 py-2 text-center">
                        <button type="button" class="text-rose-400 hover:text-rose-600 remove-tourist-btn p-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                        </button>
                    </td>
                `;
                touristsTableBody.appendChild(row);
                updateTouristRowNumbers();
            }

            function updateTouristRowNumbers() {
                const rows = touristsTableBody.querySelectorAll('tr');
                rows.forEach((row, index) => {
                    row.querySelector('td:first-child').textContent = index + 1;
                });
                touristCount = rows.length;
            }

            function calculateDuration() {
                const startDate = new Date(startDateInput.value);
                const endDate = new Date(endDateInput.value);
                if (startDateInput.value && endDateInput.value && endDate >= startDate) {
                    const diffTime = Math.abs(endDate - startDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                    durationInput.value = `${diffDays} дни / ${diffDays - 1} нощувки`;
                } else {
                    durationInput.value = '';
                }
            }
            
            async function handlePdfGeneration() {
                loadingModal.classList.remove('hidden');
                populatePdfContent();

                const { jsPDF } = window.jspdf;
                const logicalPages = document.querySelectorAll('.pdf-logical-page');
                const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
                const pdfPageWidth = doc.internal.pageSize.getWidth();
                const pdfPageHeight = doc.internal.pageSize.getHeight();

                try {
                    for (let i = 0; i < logicalPages.length; i++) {
                        const pageContent = logicalPages[i];
                        
                        if (i > 0) {
                            doc.addPage();
                        }

                        const canvas = await html2canvas(pageContent, {
                            scale: 2, useCORS: true, width: pageContent.offsetWidth,
                        });

                        const imgData = canvas.toDataURL('image/png');
                        const ratio = canvas.height / canvas.width;
                        const pdfImgHeight = pdfPageWidth * ratio;
                        let heightLeft = pdfImgHeight;
                        let position = 0;

                        doc.addImage(imgData, 'PNG', 0, position, pdfPageWidth, pdfImgHeight);
                        heightLeft -= pdfPageHeight;

                        while (heightLeft > 1) {
                            position -= pdfPageHeight;
                            doc.addPage();
                            doc.addImage(imgData, 'PNG', 0, position, pdfPageWidth, pdfImgHeight);
                            heightLeft -= pdfPageHeight;
                        }
                    }
                    
                    const fileName = `Dogovor-${document.getElementById('contractNumber').value || 'New'}.pdf`;
                    doc.save(fileName);

                } catch (err) {
                    console.error("Error generating PDF:", err);
                    alert("Грешка при генерирането. Вижте конзолата.");
                } finally {
                    loadingModal.classList.add('hidden');
                }
            }

            function populatePdfContent() {
                const formatDate = (dateString) => {
                    if (!dateString) return '..................';
                    const [year, month, day] = dateString.split('-');
                    return `${day}.${month}.${year}г.`;
                };

                const getValue = (id, suffix = '') => (document.getElementById(id).value || '..................') + suffix;
                const getOptionalValue = (id, fallback = 'Няма.') => document.getElementById(id).value || fallback;

                // Populate contract data
                document.getElementById('pdf-contractNumber').textContent = getValue('contractNumber').replace('..................', '');
                document.getElementById('pdf-signingDate').textContent = formatDate(document.getElementById('signingDate').value);
                document.getElementById('pdf-mainTouristName').textContent = getValue('mainTouristName');
                document.getElementById('pdf-mainTouristEGN').textContent = getValue('mainTouristEGN');
                document.getElementById('pdf-mainTouristIdCard').textContent = getValue('mainTouristIdCard');
                document.getElementById('pdf-mainTouristAddress').textContent = getValue('mainTouristAddress');
                document.getElementById('pdf-mainTouristPhone').textContent = getValue('mainTouristPhone');
                document.getElementById('pdf-mainTouristEmail').textContent = getValue('mainTouristEmail');
                
                // Populate trip details
                document.getElementById('pdf-startDate').textContent = formatDate(document.getElementById('startDate').value);
                document.getElementById('pdf-endDate').textContent = formatDate(document.getElementById('endDate').value);
                document.getElementById('pdf-tripDuration').textContent = getValue('tripDuration');
                document.getElementById('pdf-transportDesc').textContent = getValue('transportDesc');
                document.getElementById('pdf-departureInfo').textContent = getValue('departureInfo');
                document.getElementById('pdf-returnInfo').textContent = getValue('returnInfo');
                document.getElementById('pdf-accommodationDesc').textContent = getValue('accommodationDesc');
                document.getElementById('pdf-roomType').textContent = getValue('roomType');
                document.getElementById('pdf-mealsDesc').textContent = getValue('mealsDesc');
                document.getElementById('pdf-otherServices').textContent = getOptionalValue('otherServices');
                document.getElementById('pdf-specialReqs').textContent = getOptionalValue('specialReqs');

                // Populate financials (Now in EURO)
                document.getElementById('pdf-totalPrice').innerHTML = getValue('totalPrice', ' €');
                document.getElementById('pdf-otherPayments').innerHTML = getOptionalValue('otherPayments');
                document.getElementById('pdf-childDiscount').innerHTML = getOptionalValue('childDiscount', 'Не е приложимо.');
                document.getElementById('pdf-adultDiscount').innerHTML = getOptionalValue('adultDiscount', 'Не е приложимо.');
                document.getElementById('pdf-singleRoomFee').innerHTML = getOptionalValue('singleRoomFee', 'Не е приложимо.');
                document.getElementById('pdf-extraExcursion').innerHTML = getOptionalValue('extraExcursion');
                document.getElementById('pdf-insurance').innerHTML = getValue('insurance');
                document.getElementById('pdf-finalAmount').innerHTML = getValue('finalAmount', ' €');
                document.getElementById('pdf-paymentTerms').innerHTML = getValue('paymentTerms');
                document.getElementById('pdf-depositAmount').textContent = getValue('depositAmount');
                document.getElementById('pdf-finalPayment').innerHTML = getValue('finalPayment');

                // Populate declarations
                document.getElementById('pdf-declarationDate1').textContent = formatDate(document.getElementById('signingDate').value);
                document.getElementById('pdf-declarationDate2').textContent = formatDate(document.getElementById('signingDate').value);
                document.getElementById('pdf-declarationName').textContent = getValue('mainTouristName');
                document.getElementById('pdf-declarationEGN').textContent = getValue('mainTouristEGN');
                document.getElementById('pdf-declarationPhone').textContent = getValue('mainTouristPhone');
                document.getElementById('pdf-declarationContractNumber').textContent = getValue('contractNumber').replace('..................', '');

                // Build and insert the tourist table for the PDF
                const pdfTableContainer = document.getElementById('pdf-tourists-table-container');
                const formRows = touristsTableBody.querySelectorAll('tr');
                let tableHTML = '<table class="tourist-table-pdf"><thead><tr><th>№</th><th>Трите имена по док. за самоличност</th><th>ЕГН/ЛНЧ</th><th>№ паспорт/л.к.</th></tr></thead><tbody>';
                
                let rowsData = [];
                if (formRows.length > 0) {
                    formRows.forEach((row, index) => {
                        const name = row.querySelector('.tourist-name').value || '';
                        const egn = row.querySelector('.tourist-egn').value || '';
                        const id = row.querySelector('.tourist-id').value || '';
                        rowsData.push({index: index + 1, name, egn, id});
                    });
                }
                
                // Always generate 13 rows for the PDF table
                for (let i = 0; i < 13; i++) {
                    const data = rowsData[i];
                    tableHTML += `<tr>
                        <td>${i + 1}</td>
                        <td>${data ? data.name : ''}</td>
                        <td>${data ? data.egn : ''}</td>
                        <td>${data ? data.id : ''}</td>
                    </tr>`;
                }

                tableHTML += '</tbody></table>';
                pdfTableContainer.innerHTML = tableHTML;
            }
        });
    </script>
</body>
</html>
